{"version":3,"names":["cov_14xdlgads1","actualCoverage","common_1","s","require","config_1","passport_1","nestjs_i18n_1","passport_jwt_1","responses_1","auth_service_1","JwtStrategy","exports","PassportStrategy","Strategy","constructor","i18n","configService","authService","f","jwtFromRequest","ExtractJwt","fromAuthHeaderAsBearerToken","ignoreExpiration","secretOrKey","get","signOptions","expiresIn","validate","payload","user","validateUser","b","UnauthorizedException","authInvalidPayload","__decorate","Injectable","I18nService","ConfigService","AuthService"],"sources":["/Users/juknum/Documents/Code/AE/api/src/modules/auth/strategies/jwt.strategy.ts"],"sourcesContent":["import type { I18nTranslations, JWTPayload } from '@types';\n\nimport { Injectable, UnauthorizedException } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { PassportStrategy } from '@nestjs/passport';\nimport { I18nService } from 'nestjs-i18n';\nimport { ExtractJwt, Strategy } from 'passport-jwt';\n\nimport { authInvalidPayload } from '@utils/responses';\n\nimport { AuthService } from '../auth.service';\n\n/**\n * Strategy used to validate the user from the JWT payload\n */\n@Injectable()\nexport class JwtStrategy extends PassportStrategy(Strategy) {\n\tconstructor(\n\t\tprivate readonly i18n: I18nService<I18nTranslations>,\n\t\tprivate readonly configService: ConfigService,\n\t\tprivate readonly authService: AuthService,\n\t) {\n\t\tsuper({\n\t\t\tjwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\n\t\t\tignoreExpiration: false,\n\t\t\tsecretOrKey: configService.get<string>('auth.jwtKey'),\n\t\t\tsignOptions: { expiresIn: configService.get<number>('auth.jwtExpirationTime') },\n\t\t});\n\t}\n\n\t/**\n\t * Validate the user from the payload\n\t * @param payload - The payload from the JWT\n\t */\n\tasync validate(payload: JWTPayload) {\n\t\tconst user = await this.authService.validateUser(payload);\n\n\t\tif (!user) throw new UnauthorizedException(authInvalidPayload({ i18n: this.i18n }));\n\t\treturn user;\n\t}\n}\n"],"mappings":"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"}