{"version":3,"names":["common_1","cov_1hb98chbzz","s","require","swagger_1","express_1","__importDefault","user_entity_1","users_service_1","auth_service_1","register_dto_1","sign_in_dto_1","token_dto_1","AuthController","exports","constructor","authService","userService","f","login","signInDto","signIn","email","password","register","registerDto","verifyEmail","res","user_id","token","redirect_url","b","redirect","HttpStatus","PERMANENT_REDIRECT","trim","send","__decorate","Post","ApiOperation","summary","ApiUnauthorizedResponse","description","ApiNotFoundResponse","ApiOkResponse","type","TokenDTO","__param","Body","UserSignInDTO","User","ApiBadRequestResponse","UserPostDTO","Get","ApiParam","name","required","ApiResponse","status","Res","Param","ApiTags","Controller","AuthService","UsersService"],"sources":["/Users/juknum/Documents/Code/AE/api/src/modules/auth/auth.controller.ts"],"sourcesContent":["import { Controller, Post, Body, Param, Get, Res, HttpStatus } from '@nestjs/common';\nimport {\n\tApiBadRequestResponse,\n\tApiNotFoundResponse,\n\tApiOkResponse,\n\tApiOperation,\n\tApiParam,\n\tApiResponse,\n\tApiTags,\n\tApiUnauthorizedResponse,\n} from '@nestjs/swagger';\nimport express from 'express';\n\nimport { User } from '@modules/users/entities/user.entity';\nimport { UsersService } from '@modules/users/users.service';\n\nimport { AuthService } from './auth.service';\nimport { UserPostDTO } from './dto/register.dto';\nimport { UserSignInDTO } from './dto/sign-in.dto';\nimport { TokenDTO } from './dto/token.dto';\n\n@ApiTags('Authentification')\n@Controller('auth')\nexport class AuthController {\n\tconstructor(private readonly authService: AuthService, private readonly userService: UsersService) {}\n\n\t@Post('login')\n\t@ApiOperation({ summary: 'Sign in a user with email and password' })\n\t@ApiUnauthorizedResponse({ description: 'Unauthorized, password invalid' })\n\t@ApiNotFoundResponse({ description: 'User not found' })\n\t@ApiOkResponse({ description: 'OK', type: TokenDTO })\n\tasync login(@Body() signInDto: UserSignInDTO): Promise<TokenDTO> {\n\t\treturn this.authService.signIn(signInDto.email, signInDto.password);\n\t}\n\n\t@Post('register')\n\t@ApiOperation({ summary: 'Register a new user' })\n\t@ApiOkResponse({ description: 'User created', type: User })\n\t@ApiBadRequestResponse({ description: 'Bad request, invalid fields' })\n\tasync register(@Body() registerDto: UserPostDTO): Promise<User> {\n\t\treturn this.userService.register(registerDto);\n\t}\n\n\t@Get('confirm/:user_id/:token/:redirect_url?')\n\t@ApiParam({ name: 'redirect_url', required: false })\n\t@ApiOperation({ summary: 'Validate a user account' })\n\t@ApiOkResponse({ description: 'User account validated', type: User })\n\t@ApiNotFoundResponse({ description: 'User not found' })\n\t@ApiBadRequestResponse({ description: 'Bad request, missing id/token or email already verified' })\n\t@ApiUnauthorizedResponse({ description: 'Unauthorized, invalid token' })\n\t@ApiResponse({\n\t\tstatus: HttpStatus.PERMANENT_REDIRECT,\n\t\tdescription: 'User account validated, redirecting to redirect_url',\n\t})\n\tasync verifyEmail(\n\t\t@Res() res: express.Response,\n\t\t@Param('user_id') user_id: number,\n\t\t@Param('token') token: string,\n\t\t@Param('redirect_url') redirect_url?: string,\n\t) {\n\t\tif (redirect_url && redirect_url !== '') {\n\t\t\tawait this.userService.verifyEmail(user_id, token);\n\t\t\tres.redirect(HttpStatus.PERMANENT_REDIRECT, redirect_url.trim());\n\t\t}\n\n\t\tres.send(await this.userService.verifyEmail(user_id, token));\n\t}\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAAA,QAAA;AAAA;AAAA,CAAAC,cAAA,GAAAC,CAAA,QAAAC,OAAA;AACA,MAAAC,SAAA;AAAA;AAAA,CAAAH,cAAA,GAAAC,CAAA,QAAAC,OAAA;AAUA,MAAAE,SAAA;AAAA;AAAA,CAAAJ,cAAA,GAAAC,CAAA,QAAAI,eAAA,CAAAH,OAAA;AAEA,MAAAI,aAAA;AAAA;AAAA,CAAAN,cAAA,GAAAC,CAAA,QAAAC,OAAA;AACA,MAAAK,eAAA;AAAA;AAAA,CAAAP,cAAA,GAAAC,CAAA,QAAAC,OAAA;AAEA,MAAAM,cAAA;AAAA;AAAA,CAAAR,cAAA,GAAAC,CAAA,QAAAC,OAAA;AACA,MAAAO,cAAA;AAAA;AAAA,CAAAT,cAAA,GAAAC,CAAA,QAAAC,OAAA;AACA,MAAAQ,aAAA;AAAA;AAAA,CAAAV,cAAA,GAAAC,CAAA,QAAAC,OAAA;AACA,MAAAS,WAAA;AAAA;AAAA,CAAAX,cAAA,GAAAC,CAAA,QAAAC,OAAA;AAIO,IAAMU,cAAc;AAAA;AAAA,CAAAZ,cAAA,GAAAC,CAAA,QAAAY,OAAA,CAAAD,cAAA,GAApB,MAAMA,cAAc;EAC1BE,YAA6BC,WAAwB,EAAmBC,WAAyB;IAAA;IAAAhB,cAAA,GAAAiB,CAAA;IAAAjB,cAAA,GAAAC,CAAA;IAApE,KAAAc,WAAW,GAAXA,WAAW;IAAa;IAAAf,cAAA,GAAAC,CAAA;IAAmB,KAAAe,WAAW,GAAXA,WAAW;EAAiB;EAO9F,MAAAE,KAAKA,CAASC,SAAwB;IAAA;IAAAnB,cAAA,GAAAiB,CAAA;IAAAjB,cAAA,GAAAC,CAAA;IAC3C,OAAO,IAAI,CAACc,WAAW,CAACK,MAAM,CAACD,SAAS,CAACE,KAAK,EAAEF,SAAS,CAACG,QAAQ,CAAC;EACpE;EAMM,MAAAC,QAAQA,CAASC,WAAwB;IAAA;IAAAxB,cAAA,GAAAiB,CAAA;IAAAjB,cAAA,GAAAC,CAAA;IAC9C,OAAO,IAAI,CAACe,WAAW,CAACO,QAAQ,CAACC,WAAW,CAAC;EAC9C;EAaM,MAAAC,WAAWA,CACTC,GAAqB,EACVC,OAAe,EACjBC,KAAa,EACNC,YAAqB;IAAA;IAAA7B,cAAA,GAAAiB,CAAA;IAAAjB,cAAA,GAAAC,CAAA;IAE5C;IAAI;IAAA,CAAAD,cAAA,GAAA8B,CAAA,WAAAD,YAAY;IAAA;IAAA,CAAA7B,cAAA,GAAA8B,CAAA,WAAID,YAAY,KAAK,EAAE,GAAE;MAAA;MAAA7B,cAAA,GAAA8B,CAAA;MAAA9B,cAAA,GAAAC,CAAA;MACxC,MAAM,IAAI,CAACe,WAAW,CAACS,WAAW,CAACE,OAAO,EAAEC,KAAK,CAAC;MAAC;MAAA5B,cAAA,GAAAC,CAAA;MACnDyB,GAAG,CAACK,QAAQ,CAAChC,QAAA,CAAAiC,UAAU,CAACC,kBAAkB,EAAEJ,YAAY,CAACK,IAAI,EAAE,CAAC;KAChE;IAAA;IAAA;MAAAlC,cAAA,GAAA8B,CAAA;IAAA;IAAA9B,cAAA,GAAAC,CAAA;IAEDyB,GAAG,CAACS,IAAI,CAAC,MAAM,IAAI,CAACnB,WAAW,CAACS,WAAW,CAACE,OAAO,EAAEC,KAAK,CAAC,CAAC;EAC7D;CACA;AAAA;AAAA5B,cAAA,GAAAC,CAAA;AApCMmC,UAAA,EALL,IAAArC,QAAA,CAAAsC,IAAI,EAAC,OAAO,CAAC,EACb,IAAAlC,SAAA,CAAAmC,YAAY,EAAC;EAAEC,OAAO,EAAE;AAAwC,CAAE,CAAC,EACnE,IAAApC,SAAA,CAAAqC,uBAAuB,EAAC;EAAEC,WAAW,EAAE;AAAgC,CAAE,CAAC,EAC1E,IAAAtC,SAAA,CAAAuC,mBAAmB,EAAC;EAAED,WAAW,EAAE;AAAgB,CAAE,CAAC,EACtD,IAAAtC,SAAA,CAAAwC,aAAa,EAAC;EAAEF,WAAW,EAAE,IAAI;EAAEG,IAAI,EAAEjC,WAAA,CAAAkC;AAAQ,CAAE,CAAC,EACxCC,OAAA,QAAA/C,QAAA,CAAAgD,IAAI,GAAE,G,sEAAYrC,aAAA,CAAAsC,aAAa,I,mFAE3C;AAAA;AAAAhD,cAAA,GAAAC,CAAA;AAMKmC,UAAA,EAJL,IAAArC,QAAA,CAAAsC,IAAI,EAAC,UAAU,CAAC,EAChB,IAAAlC,SAAA,CAAAmC,YAAY,EAAC;EAAEC,OAAO,EAAE;AAAqB,CAAE,CAAC,EAChD,IAAApC,SAAA,CAAAwC,aAAa,EAAC;EAAEF,WAAW,EAAE,cAAc;EAAEG,IAAI,EAAEtC,aAAA,CAAA2C;AAAI,CAAE,CAAC,EAC1D,IAAA9C,SAAA,CAAA+C,qBAAqB,EAAC;EAAET,WAAW,EAAE;AAA6B,CAAE,CAAC,EACtDK,OAAA,QAAA/C,QAAA,CAAAgD,IAAI,GAAE,G,sEAActC,cAAA,CAAA0C,WAAW,I,sFAE9C;AAAA;AAAAnD,cAAA,GAAAC,CAAA;AAaKmC,UAAA,EAXL,IAAArC,QAAA,CAAAqD,GAAG,EAAC,wCAAwC,CAAC,EAC7C,IAAAjD,SAAA,CAAAkD,QAAQ,EAAC;EAAEC,IAAI,EAAE,cAAc;EAAEC,QAAQ,EAAE;AAAK,CAAE,CAAC,EACnD,IAAApD,SAAA,CAAAmC,YAAY,EAAC;EAAEC,OAAO,EAAE;AAAyB,CAAE,CAAC,EACpD,IAAApC,SAAA,CAAAwC,aAAa,EAAC;EAAEF,WAAW,EAAE,wBAAwB;EAAEG,IAAI,EAAEtC,aAAA,CAAA2C;AAAI,CAAE,CAAC,EACpE,IAAA9C,SAAA,CAAAuC,mBAAmB,EAAC;EAAED,WAAW,EAAE;AAAgB,CAAE,CAAC,EACtD,IAAAtC,SAAA,CAAA+C,qBAAqB,EAAC;EAAET,WAAW,EAAE;AAAyD,CAAE,CAAC,EACjG,IAAAtC,SAAA,CAAAqC,uBAAuB,EAAC;EAAEC,WAAW,EAAE;AAA6B,CAAE,CAAC,EACvE,IAAAtC,SAAA,CAAAqD,WAAW,EAAC;EACZC,MAAM,EAAE1D,QAAA,CAAAiC,UAAU,CAACC,kBAAkB;EACrCQ,WAAW,EAAE;CACb,CAAC,EAEAK,OAAA,QAAA/C,QAAA,CAAA2D,GAAG,GAAE,GACLZ,OAAA,QAAA/C,QAAA,CAAA4D,KAAK,EAAC,SAAS,CAAC,GAChBb,OAAA,QAAA/C,QAAA,CAAA4D,KAAK,EAAC,OAAO,CAAC,GACdb,OAAA,QAAA/C,QAAA,CAAA4D,KAAK,EAAC,cAAc,CAAC,G,iMAQtB;AAAA;AAAA3D,cAAA,GAAAC,CAAA;yBA3CWW,cAAc,GAAAwB,UAAA,EAF1B,IAAAjC,SAAA,CAAAyD,OAAO,EAAC,kBAAkB,CAAC,EAC3B,IAAA7D,QAAA,CAAA8D,UAAU,EAAC,MAAM,CAAC,E,iCAEwBrD,cAAA,CAAAsD,WAAW,EAAgCvD,eAAA,CAAAwD,YAAY,G,EADrFnD,cAAc,CA4C1B"}