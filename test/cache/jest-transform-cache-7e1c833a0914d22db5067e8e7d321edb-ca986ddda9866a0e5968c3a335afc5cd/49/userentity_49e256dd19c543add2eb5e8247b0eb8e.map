{"file":"/Users/juknum/Documents/Code/AE/api/src/modules/users/entities/user.entity.ts","mappings":"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","names":[],"sources":["/Users/juknum/Documents/Code/AE/api/src/modules/users/entities/user.entity.ts"],"sourcesContent":["import type { UserEntity, Email } from '@types';\n\nimport {\n\tCascade,\n\tCollection,\n\tEntity,\n\tEntityDTO,\n\tManyToMany,\n\tManyToOne,\n\tOneToMany,\n\tOneToOne,\n\tProperty,\n} from '@mikro-orm/core';\nimport { ApiProperty } from '@nestjs/swagger';\n\nimport { BaseEntity } from '@modules/_mixin/entities/base.entity';\nimport { Log } from '@modules/logs/entities/log.entity';\nimport { Permission } from '@modules/permissions/entities/permission.entity';\nimport { Promotion } from '@modules/promotions/entities/promotion.entity';\nimport { Role } from '@modules/roles/entities/role.entity';\nimport { Subscription } from '@modules/subscription/entities/subscription.entity';\n\nimport { UserBanner } from './user-banner.entity';\nimport { UserPicture } from './user-picture.entity';\n\n@Entity({ tableName: 'users' })\nexport class User\n\textends BaseEntity\n\timplements UserEntity<UserPicture, UserBanner, Promotion, Permission, Role, Subscription, Log>\n{\n\t//* INFORMATIONS\n\t/** The first name of the user, @example 'John' */\n\t@Property()\n\t@ApiProperty()\n\tfirst_name: string;\n\n\t/** The last name of the user, @example 'Doe' */\n\t@Property()\n\t@ApiProperty()\n\tlast_name: string;\n\n\t@Property({ onCreate: () => false })\n\t@ApiProperty({ type: Boolean })\n\temail_verified = false;\n\n\t@Property({ nullable: true, hidden: true })\n\temail_verification?: string;\n\n\t/** Get the full name of the user */\n\t@Property({ persist: false })\n\t@ApiProperty()\n\tget full_name(): string {\n\t\treturn `${this.first_name} ${this.last_name}`;\n\t}\n\n\t/** The user profile picture */\n\t@OneToOne(() => UserPicture, (picture) => picture.user, { cascade: [Cascade.ALL], nullable: true })\n\t@ApiProperty()\n\tpicture?: UserPicture;\n\n\t/** The user profile banner */\n\t@OneToOne(() => UserBanner, (banner) => banner.user, { cascade: [Cascade.ALL], nullable: true })\n\t@ApiProperty()\n\tbanner?: UserBanner;\n\n\t/** The main email of the user, used to login, @example 'example@domain.net' */\n\t@Property({ unique: true, type: String })\n\t@ApiProperty({ type: String })\n\temail: Email;\n\n\t/** The encrypted user password */\n\t@Property({ hidden: true })\n\tpassword: string;\n\n\t/** The birthday of the user */\n\t@Property({ type: 'date' })\n\t@ApiProperty()\n\tbirthday: Date;\n\n\t/** The age of the user */\n\t@Property({ persist: false })\n\t@ApiProperty()\n\tget age(): number {\n\t\tconst diff = Date.now() - this.birthday.getTime();\n\t\tconst age = new Date(diff);\n\t\treturn Math.abs(age.getUTCFullYear() - 1970);\n\t}\n\n\t/** True if the user is minor */\n\t@Property({ persist: false })\n\t@ApiProperty()\n\tget is_minor(): boolean {\n\t\treturn this.age < 18;\n\t}\n\n\t/** The nickname of the user, @example 'fenshmirtz' // + Doe => Doofenshmirtz */\n\t@Property({ nullable: true })\n\t@ApiProperty()\n\tnickname?: string;\n\n\t/** Gender of the user */\n\t@Property({ nullable: true })\n\t@ApiProperty()\n\tgender?: string;\n\n\t/** The pronouns of the user */\n\t@Property({ nullable: true })\n\t@ApiProperty()\n\tpronouns?: string;\n\n\t/** Cursus of the user within the school */\n\t// TODO: use an entity relation ?\n\t@Property({ nullable: true })\n\t@ApiProperty()\n\tcursus?: string;\n\n\t/** Specialty of the user */\n\t// TODO: use an entity relation ?\n\t@Property({ nullable: true })\n\t@ApiProperty()\n\tspecialty?: string;\n\n\t/** Promotion of the user */\n\t@ManyToOne(() => Promotion, { nullable: true })\n\t@ApiProperty({ type: Number })\n\tpromotion?: Promotion;\n\n\t/** The last time the user was seen online (JWT Token generated) */\n\t@Property({ type: 'date', nullable: true })\n\t@ApiProperty()\n\tlast_seen?: Date;\n\n\t//* SUBSCRIPTIONS\n\t/** The subscription of the user */\n\t@OneToMany(() => Subscription, (subscription) => subscription.user, {\n\t\tcascade: [Cascade.REMOVE],\n\t\tnullable: true,\n\t\torphanRemoval: true,\n\t})\n\tsubscriptions?: Collection<Subscription>;\n\n\t/** Subscriber account number, undefined if he never subscribed */\n\t@Property({ nullable: true })\n\t@ApiProperty()\n\tsubscriber_account?: string;\n\n\t/** The current subscription of the user */\n\t@Property({ persist: false })\n\tget current_subscription(): EntityDTO<Subscription> | undefined {\n\t\treturn this.subscriptions.toArray().find((subscription) => subscription.is_active);\n\t}\n\n\t/** True if the user is currently subscribed */\n\t@Property({ persist: false })\n\t@ApiProperty()\n\tget is_currently_subscribed(): boolean {\n\t\treturn this.current_subscription !== undefined;\n\t}\n\n\t//* CONTACT\n\t/** The secondary email of the user, used for communications emails */\n\t@Property({ nullable: true })\n\t@ApiProperty()\n\tsecondary_email?: string;\n\n\t/** The phone number of the user */\n\t@Property({ nullable: true })\n\t@ApiProperty()\n\tphone?: string;\n\n\t/** Parent contact (for minors only) */\n\t@Property({ nullable: true })\n\t@ApiProperty()\n\tparent_contact?: string;\n\n\t//* PERMISSIONS & AUTHENTIFICATION\n\t/** Linked permissions to the user */\n\t@OneToMany(() => Permission, (permission) => permission.user, { cascade: [Cascade.REMOVE], orphanRemoval: true })\n\tpermissions = new Collection<Permission>(this);\n\n\t/** Linked roles to the user */\n\t@ManyToMany(() => Role, (role) => role.users)\n\troles = new Collection<Role>(this);\n\n\t@OneToMany(() => Log, (log) => log.user, { cascade: [Cascade.REMOVE], orphanRemoval: true })\n\tlogs = new Collection<Log>(this);\n}\n"],"version":3}