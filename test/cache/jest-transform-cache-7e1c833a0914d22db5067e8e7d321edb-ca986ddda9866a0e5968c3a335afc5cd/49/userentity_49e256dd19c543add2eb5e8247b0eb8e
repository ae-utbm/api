46e4274c257ff3d5072757235e12d5b6
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.User = void 0;
const core_1 = require("@mikro-orm/core");
const swagger_1 = require("@nestjs/swagger");
const base_entity_1 = require("@modules/_mixin/entities/base.entity");
const log_entity_1 = require("@modules/logs/entities/log.entity");
const permission_entity_1 = require("@modules/permissions/entities/permission.entity");
const promotion_entity_1 = require("@modules/promotions/entities/promotion.entity");
const role_entity_1 = require("@modules/roles/entities/role.entity");
const subscription_entity_1 = require("@modules/subscription/entities/subscription.entity");
const user_banner_entity_1 = require("./user-banner.entity");
const user_picture_entity_1 = require("./user-picture.entity");
let User = exports.User = class User extends base_entity_1.BaseEntity {
    constructor() {
        super(...arguments);
        this.email_verified = false;
        //* PERMISSIONS & AUTHENTIFICATION
        /** Linked permissions to the user */
        this.permissions = new core_1.Collection(this);
        /** Linked roles to the user */
        this.roles = new core_1.Collection(this);
        this.logs = new core_1.Collection(this);
    }
    /** Get the full name of the user */
    get full_name() {
        return `${this.first_name} ${this.last_name}`;
    }
    /** The age of the user */
    get age() {
        const diff = Date.now() - this.birthday.getTime();
        const age = new Date(diff);
        return Math.abs(age.getUTCFullYear() - 1970);
    }
    /** True if the user is minor */
    get is_minor() {
        return this.age < 18;
    }
    /** The current subscription of the user */
    get current_subscription() {
        return this.subscriptions.toArray().find((subscription) => subscription.is_active);
    }
    /** True if the user is currently subscribed */
    get is_currently_subscribed() {
        return this.current_subscription !== undefined;
    }
};
__decorate([
    (0, core_1.Property)(),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", String)
], User.prototype, "first_name", void 0);
__decorate([
    (0, core_1.Property)(),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", String)
], User.prototype, "last_name", void 0);
__decorate([
    (0, core_1.Property)({ onCreate: () => false }),
    (0, swagger_1.ApiProperty)({ type: Boolean }),
    __metadata("design:type", Object)
], User.prototype, "email_verified", void 0);
__decorate([
    (0, core_1.Property)({ nullable: true, hidden: true }),
    __metadata("design:type", String)
], User.prototype, "email_verification", void 0);
__decorate([
    (0, core_1.Property)({ persist: false }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], User.prototype, "full_name", null);
__decorate([
    (0, core_1.OneToOne)(() => user_picture_entity_1.UserPicture, (picture) => picture.user, { cascade: [core_1.Cascade.ALL], nullable: true }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", user_picture_entity_1.UserPicture)
], User.prototype, "picture", void 0);
__decorate([
    (0, core_1.OneToOne)(() => user_banner_entity_1.UserBanner, (banner) => banner.user, { cascade: [core_1.Cascade.ALL], nullable: true }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", user_banner_entity_1.UserBanner)
], User.prototype, "banner", void 0);
__decorate([
    (0, core_1.Property)({ unique: true, type: String }),
    (0, swagger_1.ApiProperty)({ type: String }),
    __metadata("design:type", String)
], User.prototype, "email", void 0);
__decorate([
    (0, core_1.Property)({ hidden: true }),
    __metadata("design:type", String)
], User.prototype, "password", void 0);
__decorate([
    (0, core_1.Property)({ type: 'date' }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", Date)
], User.prototype, "birthday", void 0);
__decorate([
    (0, core_1.Property)({ persist: false }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", Number),
    __metadata("design:paramtypes", [])
], User.prototype, "age", null);
__decorate([
    (0, core_1.Property)({ persist: false }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], User.prototype, "is_minor", null);
__decorate([
    (0, core_1.Property)({ nullable: true }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", String)
], User.prototype, "nickname", void 0);
__decorate([
    (0, core_1.Property)({ nullable: true }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", String)
], User.prototype, "gender", void 0);
__decorate([
    (0, core_1.Property)({ nullable: true }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", String)
], User.prototype, "pronouns", void 0);
__decorate([
    (0, core_1.Property)({ nullable: true }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", String)
], User.prototype, "cursus", void 0);
__decorate([
    (0, core_1.Property)({ nullable: true }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", String)
], User.prototype, "specialty", void 0);
__decorate([
    (0, core_1.ManyToOne)(() => promotion_entity_1.Promotion, { nullable: true }),
    (0, swagger_1.ApiProperty)({ type: Number }),
    __metadata("design:type", promotion_entity_1.Promotion)
], User.prototype, "promotion", void 0);
__decorate([
    (0, core_1.Property)({ type: 'date', nullable: true }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", Date)
], User.prototype, "last_seen", void 0);
__decorate([
    (0, core_1.OneToMany)(() => subscription_entity_1.Subscription, (subscription) => subscription.user, {
        cascade: [core_1.Cascade.REMOVE],
        nullable: true,
        orphanRemoval: true,
    }),
    __metadata("design:type", core_1.Collection)
], User.prototype, "subscriptions", void 0);
__decorate([
    (0, core_1.Property)({ nullable: true }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", String)
], User.prototype, "subscriber_account", void 0);
__decorate([
    (0, core_1.Property)({ persist: false }),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [])
], User.prototype, "current_subscription", null);
__decorate([
    (0, core_1.Property)({ persist: false }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], User.prototype, "is_currently_subscribed", null);
__decorate([
    (0, core_1.Property)({ nullable: true }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", String)
], User.prototype, "secondary_email", void 0);
__decorate([
    (0, core_1.Property)({ nullable: true }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", String)
], User.prototype, "phone", void 0);
__decorate([
    (0, core_1.Property)({ nullable: true }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", String)
], User.prototype, "parent_contact", void 0);
__decorate([
    (0, core_1.OneToMany)(() => permission_entity_1.Permission, (permission) => permission.user, { cascade: [core_1.Cascade.REMOVE], orphanRemoval: true }),
    __metadata("design:type", Object)
], User.prototype, "permissions", void 0);
__decorate([
    (0, core_1.ManyToMany)(() => role_entity_1.Role, (role) => role.users),
    __metadata("design:type", Object)
], User.prototype, "roles", void 0);
__decorate([
    (0, core_1.OneToMany)(() => log_entity_1.Log, (log) => log.user, { cascade: [core_1.Cascade.REMOVE], orphanRemoval: true }),
    __metadata("design:type", Object)
], User.prototype, "logs", void 0);
exports.User = User = __decorate([
    (0, core_1.Entity)({ tableName: 'users' })
], User);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2p1a251bS9Eb2N1bWVudHMvQ29kZS9BRS9hcGkvc3JjL21vZHVsZXMvdXNlcnMvZW50aXRpZXMvdXNlci5lbnRpdHkudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBRUEsMENBVXlCO0FBQ3pCLDZDQUE4QztBQUU5QyxzRUFBa0U7QUFDbEUsa0VBQXdEO0FBQ3hELHVGQUE2RTtBQUM3RSxvRkFBMEU7QUFDMUUscUVBQTJEO0FBQzNELDRGQUFrRjtBQUVsRiw2REFBa0Q7QUFDbEQsK0RBQW9EO0FBRzdDLElBQU0sSUFBSSxrQkFBVixNQUFNLElBQ1osU0FBUSx3QkFBVTtJQURaOztRQWlCTixtQkFBYyxHQUFHLEtBQUssQ0FBQztRQW9JdkIsa0NBQWtDO1FBQ2xDLHFDQUFxQztRQUVyQyxnQkFBVyxHQUFHLElBQUksaUJBQVUsQ0FBYSxJQUFJLENBQUMsQ0FBQztRQUUvQywrQkFBK0I7UUFFL0IsVUFBSyxHQUFHLElBQUksaUJBQVUsQ0FBTyxJQUFJLENBQUMsQ0FBQztRQUduQyxTQUFJLEdBQUcsSUFBSSxpQkFBVSxDQUFNLElBQUksQ0FBQyxDQUFDO0lBQ2xDLENBQUM7SUExSUEsb0NBQW9DO0lBQ3BDLElBRUksU0FBUztRQUNaLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUMvQyxDQUFDO0lBMEJELDBCQUEwQjtJQUMxQixJQUVJLEdBQUc7UUFDTixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNsRCxNQUFNLEdBQUcsR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFFRCxnQ0FBZ0M7SUFDaEMsSUFFSSxRQUFRO1FBQ1gsT0FBTyxJQUFJLENBQUMs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QUZDLElBQUEsZUFBUSxFQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDO0lBQzVCLElBQUEscUJBQVcsR0FBRTs7NkNBQ1c7QUFLekI7SUFGQyxJQUFBLGVBQVEsRUFBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQztJQUM1QixJQUFBLHFCQUFXLEdBQUU7O21DQUNDO0FBS2Y7SUFGQyxJQUFBLGVBQVEsRUFBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQztJQUM1QixJQUFBLHFCQUFXLEdBQUU7OzRDQUNVO0FBS3hCO0lBREMsSUFBQSxnQkFBUyxFQUFDLEdBQUcsRUFBRSxDQUFDLDhCQUFVLEVBQUUsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsRUFBRSxPQUFPLEVBQUUsQ0FBQyxjQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsYUFBYSxFQUFFLElBQUksRUFBRSxDQUFDOzt5Q0FDbEU7QUFJL0M7SUFEQyxJQUFBLGlCQUFVLEVBQUMsR0FBRyxFQUFFLENBQUMsa0JBQUksRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQzs7bUNBQ1Y7QUFHbkM7SUFEQyxJQUFBLGdCQUFTLEVBQUMsR0FBRyxFQUFFLENBQUMsZ0JBQUcsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxFQUFFLE9BQU8sRUFBRSxDQUFDLGNBQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFFLENBQUM7O2tDQUMzRDtlQS9KckIsSUFBSTtJQURoQixJQUFBLGFBQU0sRUFBQyxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsQ0FBQztHQUNsQixJQUFJLENBZ0toQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvanVrbnVtL0RvY3VtZW50cy9Db2RlL0FFL2FwaS9zcmMvbW9kdWxlcy91c2Vycy9lbnRpdGllcy91c2VyLmVudGl0eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFVzZXJFbnRpdHksIEVtYWlsIH0gZnJvbSAnQHR5cGVzJztcblxuaW1wb3J0IHtcblx0Q2FzY2FkZSxcblx0Q29sbGVjdGlvbixcblx0RW50aXR5LFxuXHRFbnRpdHlEVE8sXG5cdE1hbnlUb01hbnksXG5cdE1hbnlUb09uZSxcblx0T25lVG9NYW55LFxuXHRPbmVUb09uZSxcblx0UHJvcGVydHksXG59IGZyb20gJ0BtaWtyby1vcm0vY29yZSc7XG5pbXBvcnQgeyBBcGlQcm9wZXJ0eSB9IGZyb20gJ0BuZXN0anMvc3dhZ2dlcic7XG5cbmltcG9ydCB7IEJhc2VFbnRpdHkgfSBmcm9tICdAbW9kdWxlcy9fbWl4aW4vZW50aXRpZXMvYmFzZS5lbnRpdHknO1xuaW1wb3J0IHsgTG9nIH0gZnJvbSAnQG1vZHVsZXMvbG9ncy9lbnRpdGllcy9sb2cuZW50aXR5JztcbmltcG9ydCB7IFBlcm1pc3Npb24gfSBmcm9tICdAbW9kdWxlcy9wZXJtaXNzaW9ucy9lbnRpdGllcy9wZXJtaXNzaW9uLmVudGl0eSc7XG5pbXBvcnQgeyBQcm9tb3Rpb24gfSBmcm9tICdAbW9kdWxlcy9wcm9tb3Rpb25zL2VudGl0aWVzL3Byb21vdGlvbi5lbnRpdHknO1xuaW1wb3J0IHsgUm9sZSB9IGZyb20gJ0Btb2R1bGVzL3JvbGVzL2VudGl0aWVzL3JvbGUuZW50aXR5JztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ0Btb2R1bGVzL3N1YnNjcmlwdGlvbi9lbnRpdGllcy9zdWJzY3JpcHRpb24uZW50aXR5JztcblxuaW1wb3J0IHsgVXNlckJhbm5lciB9IGZyb20gJy4vdXNlci1iYW5uZXIuZW50aXR5JztcbmltcG9ydCB7IFVzZXJQaWN0dXJlIH0gZnJvbSAnLi91c2VyLXBpY3R1cmUuZW50aXR5JztcblxuQEVudGl0eSh7IHRhYmxlTmFtZTogJ3VzZXJzJyB9KVxuZXhwb3J0IGNsYXNzIFVzZXJcblx0ZXh0ZW5kcyBCYXNlRW50aXR5XG5cdGltcGxlbWVudHMgVXNlckVudGl0eTxVc2VyUGljdHVyZSwgVXNlckJhbm5lciwgUHJvbW90aW9uLCBQZXJtaXNzaW9uLCBSb2xlLCBTdWJzY3JpcHRpb24sIExvZz5cbntcblx0Ly8qIElORk9STUFUSU9OU1xuXHQvKiogVGhlIGZpcnN0IG5hbWUgb2YgdGhlIHVzZXIsIEBleGFtcGxlICdKb2huJyAqL1xuXHRAUHJvcGVydHkoKVxuXHRAQXBpUHJvcGVydHkoKVxuXHRmaXJzdF9uYW1lOiBzdHJpbmc7XG5cblx0LyoqIFRoZSBsYXN0IG5hbWUgb2YgdGhlIHVzZXIsIEBleGFtcGxlICdEb2UnICovXG5cdEBQcm9wZXJ0eSgpXG5cdEBBcGlQcm9wZXJ0eSgpXG5cdGxhc3RfbmFtZTogc3RyaW5nO1xuXG5cdEBQcm9wZXJ0eSh7IG9uQ3JlYXRlOiAoKSA9PiBmYWxzZSB9KVxuXHRAQXBpUHJvcGVydHkoeyB0eXBlOiBCb29sZWFuIH0pXG5cdGVtYWlsX3ZlcmlmaWVkID0gZmFsc2U7XG5cblx0QFByb3BlcnR5KHsgbnVsbGFibGU6IHRydWUsIGhpZGRlbjogdHJ1ZSB9KVxuXHRlbWFpbF92ZXJpZmljYXRpb24/OiBzdHJpbmc7XG5cblx0LyoqIEdldCB0aGUgZnVsbCBuYW1lIG9mIHRoZSB1c2VyICovXG5cdEBQcm9wZXJ0eSh7IHBlcnNpc3Q6IGZhbHNlIH0pXG5cdEBBcGlQcm9wZXJ0eSgpXG5cdGdldCBmdWxsX25hbWUoKTogc3RyaW5nIHtcblx0XHRyZXR1cm4gYCR7dGhpcy5maXJzdF9uYW1lfSAke3RoaXMubGFzdF9uYW1lfWA7XG5cdH1cblxuXHQvKiogVGhlIHVzZXIgcHJvZmlsZSBwaWN0dXJlICovXG5cdEBPbmVUb09uZSgoKSA9PiBVc2VyUGljdHVyZSwgKHBpY3R1cmUpID0+IHBpY3R1cmUudXNlciwgeyBjYXNjYWRlOiBbQ2FzY2FkZS5BTExdLCBudWxsYWJsZTogdHJ1ZSB9KVxuXHRAQXBpUHJvcGVydHkoKVxuXHRwaWN0dXJlPzogVXNlclBpY3R1cmU7XG5cblx0LyoqIFRoZSB1c2VyIHByb2ZpbGUgYmFubmVyICovXG5cdEBPbmVUb09uZSgoKSA9PiBVc2VyQmFubmVyLCAoYmFubmVyKSA9PiBiYW5uZXIudXNlciwgeyBjYXNjYWRlOiBbQ2FzY2FkZS5BTExdLCBudWxsYWJsZTogdHJ1ZSB9KVxuXHRAQXBpUHJvcGVydHkoKVxuXHRiYW5uZXI/OiBVc2VyQmFubmVyO1xuXG5cdC8qKiBUaGUgbWFpbiBlbWFpbCBvZiB0aGUgdXNlciwgdXNlZCB0byBsb2dpbiwgQGV4YW1wbGUgJ2V4YW1wbGVAZG9tYWluLm5ldCcgKi9cblx0QFByb3BlcnR5KHsgdW5pcXVlOiB0cnVlLCB0eXBlOiBTdHJpbmcgfSlcblx0QEFwaVByb3BlcnR5KHsgdHlwZTogU3RyaW5nIH0pXG5cdGVtYWlsOiBFbWFpbDtcblxuXHQvKiogVGhlIGVuY3J5cHRlZCB1c2VyIHBhc3N3b3JkICovXG5cdEBQcm9wZXJ0eSh7IGhpZGRlbjogdHJ1ZSB9KVxuXHRwYXNzd29yZDogc3RyaW5nO1xuXG5cdC8qKiBUaGUgYmlydGhkYXkgb2YgdGhlIHVzZXIgKi9cblx0QFByb3BlcnR5KHsgdHlwZTogJ2RhdGUnIH0pXG5cdEBBcGlQcm9wZXJ0eSgpXG5cdGJpcnRoZGF5OiBEYXRlO1xuXG5cdC8qKiBUaGUgYWdlIG9mIHRoZSB1c2VyICovXG5cdEBQcm9wZXJ0eSh7IHBlcnNpc3Q6IGZhbHNlIH0pXG5cdEBBcGlQcm9wZXJ0eSgpXG5cdGdldCBhZ2UoKTogbnVtYmVyIHtcblx0XHRjb25zdCBkaWZmID0gRGF0ZS5ub3coKSAtIHRoaXMuYmlydGhkYXkuZ2V0VGltZSgpO1xuXHRcdGNvbnN0IGFnZSA9IG5ldyBEYXRlKGRpZmYpO1xuXHRcdHJldHVybiBNYXRoLmFicyhhZ2UuZ2V0VVRDRnVsbFllYXIoKSAtIDE5NzApO1xuXHR9XG5cblx0LyoqIFRydWUgaWYgdGhlIHVzZXIgaXMgbWlub3IgKi9cblx0QFByb3BlcnR5KHsgcGVyc2lzdDogZmFsc2UgfSlcblx0QEFwaVByb3BlcnR5KClcblx0Z2V0IGlzX21pbm9yKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiB0aGlzLmFnZSA8IDE4O1xuXHR9XG5cblx0LyoqIFRoZSBuaWNrbmFtZSBvZiB0aGUgdXNlciwgQGV4YW1wbGUgJ2ZlbnNobWlydHonIC8vICsgRG9lID0+IERvb2ZlbnNobWlydHogKi9cblx0QFByb3BlcnR5KHsgbnVsbGFibGU6IHRydWUgfSlcblx0QEFwaVByb3BlcnR5KClcblx0bmlja25hbWU/OiBzdHJpbmc7XG5cblx0LyoqIEdlbmRlciBvZiB0aGUgdXNlciAqL1xuXHRAUHJvcGVydHkoeyBudWxsYWJsZTogdHJ1ZSB9KVxuXHRAQXBpUHJvcGVydHkoKVxuXHRnZW5kZXI/OiBzdHJpbmc7XG5cblx0LyoqIFRoZSBwcm9ub3VucyBvZiB0aGUgdXNlciAqL1xuXHRAUHJvcGVydHkoeyBudWxsYWJsZTogdHJ1ZSB9KVxuXHRAQXBpUHJvcGVydHkoKVxuXHRwcm9ub3Vucz86IHN0cmluZztcblxuXHQvKiogQ3Vyc3VzIG9mIHRoZSB1c2VyIHdpdGhpbiB0aGUgc2Nob29sICovXG5cdC8vIFRPRE86IHVzZSBhbiBlbnRpdHkgcmVsYXRpb24gP1xuXHRAUHJvcGVydHkoeyBudWxsYWJsZTogdHJ1ZSB9KVxuXHRAQXBpUHJvcGVydHkoKVxuXHRjdXJzdXM/OiBzdHJpbmc7XG5cblx0LyoqIFNwZWNpYWx0eSBvZiB0aGUgdXNlciAqL1xuXHQvLyBUT0RPOiB1c2UgYW4gZW50aXR5IHJlbGF0aW9uID9cblx0QFByb3BlcnR5KHsgbnVsbGFibGU6IHRydWUgfSlcblx0QEFwaVByb3BlcnR5KClcblx0c3BlY2lhbHR5Pzogc3RyaW5nO1xuXG5cdC8qKiBQcm9tb3Rpb24gb2YgdGhlIHVzZXIgKi9cblx0QE1hbnlUb09uZSgoKSA9PiBQcm9tb3Rpb24sIHsgbnVsbGFibGU6IHRydWUgfSlcblx0QEFwaVByb3BlcnR5KHsgdHlwZTogTnVtYmVyIH0pXG5cdHByb21vdGlvbj86IFByb21vdGlvbjtcblxuXHQvKiogVGhlIGxhc3QgdGltZSB0aGUgdXNlciB3YXMgc2VlbiBvbmxpbmUgKEpXVCBUb2tlbiBnZW5lcmF0ZWQpICovXG5cdEBQcm9wZXJ0eSh7IHR5cGU6ICdkYXRlJywgbnVsbGFibGU6IHRydWUgfSlcblx0QEFwaVByb3BlcnR5KClcblx0bGFzdF9zZWVuPzogRGF0ZTtcblxuXHQvLyogU1VCU0NSSVBUSU9OU1xuXHQvKiogVGhlIHN1YnNjcmlwdGlvbiBvZiB0aGUgdXNlciAqL1xuXHRAT25lVG9NYW55KCgpID0+IFN1YnNjcmlwdGlvbiwgKHN1YnNjcmlwdGlvbikgPT4gc3Vic2NyaXB0aW9uLnVzZXIsIHtcblx0XHRjYXNjYWRlOiBbQ2FzY2FkZS5SRU1PVkVdLFxuXHRcdG51bGxhYmxlOiB0cnVlLFxuXHRcdG9ycGhhblJlbW92YWw6IHRydWUsXG5cdH0pXG5cdHN1YnNjcmlwdGlvbnM/OiBDb2xsZWN0aW9uPFN1YnNjcmlwdGlvbj47XG5cblx0LyoqIFN1YnNjcmliZXIgYWNjb3VudCBudW1iZXIsIHVuZGVmaW5lZCBpZiBoZSBuZXZlciBzdWJzY3JpYmVkICovXG5cdEBQcm9wZXJ0eSh7IG51bGxhYmxlOiB0cnVlIH0pXG5cdEBBcGlQcm9wZXJ0eSgpXG5cdHN1YnNjcmliZXJfYWNjb3VudD86IHN0cmluZztcblxuXHQvKiogVGhlIGN1cnJlbnQgc3Vic2NyaXB0aW9uIG9mIHRoZSB1c2VyICovXG5cdEBQcm9wZXJ0eSh7IHBlcnNpc3Q6IGZhbHNlIH0pXG5cdGdldCBjdXJyZW50X3N1YnNjcmlwdGlvbigpOiBFbnRpdHlEVE88U3Vic2NyaXB0aW9uPiB8IHVuZGVmaW5lZCB7XG5cdFx0cmV0dXJuIHRoaXMuc3Vic2NyaXB0aW9ucy50b0FycmF5KCkuZmluZCgoc3Vic2NyaXB0aW9uKSA9PiBzdWJzY3JpcHRpb24uaXNfYWN0aXZlKTtcblx0fVxuXG5cdC8qKiBUcnVlIGlmIHRoZSB1c2VyIGlzIGN1cnJlbnRseSBzdWJzY3JpYmVkICovXG5cdEBQcm9wZXJ0eSh7IHBlcnNpc3Q6IGZhbHNlIH0pXG5cdEBBcGlQcm9wZXJ0eSgpXG5cdGdldCBpc19jdXJyZW50bHlfc3Vic2NyaWJlZCgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdGhpcy5jdXJyZW50X3N1YnNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkO1xuXHR9XG5cblx0Ly8qIENPTlRBQ1Rcblx0LyoqIFRoZSBzZWNvbmRhcnkgZW1haWwgb2YgdGhlIHVzZXIsIHVzZWQgZm9yIGNvbW11bmljYXRpb25zIGVtYWlscyAqL1xuXHRAUHJvcGVydHkoeyBudWxsYWJsZTogdHJ1ZSB9KVxuXHRAQXBpUHJvcGVydHkoKVxuXHRzZWNvbmRhcnlfZW1haWw/OiBzdHJpbmc7XG5cblx0LyoqIFRoZSBwaG9uZSBudW1iZXIgb2YgdGhlIHVzZXIgKi9cblx0QFByb3BlcnR5KHsgbnVsbGFibGU6IHRydWUgfSlcblx0QEFwaVByb3BlcnR5KClcblx0cGhvbmU/OiBzdHJpbmc7XG5cblx0LyoqIFBhcmVudCBjb250YWN0IChmb3IgbWlub3JzIG9ubHkpICovXG5cdEBQcm9wZXJ0eSh7IG51bGxhYmxlOiB0cnVlIH0pXG5cdEBBcGlQcm9wZXJ0eSgpXG5cdHBhcmVudF9jb250YWN0Pzogc3RyaW5nO1xuXG5cdC8vKiBQRVJNSVNTSU9OUyAmIEFVVEhFTlRJRklDQVRJT05cblx0LyoqIExpbmtlZCBwZXJtaXNzaW9ucyB0byB0aGUgdXNlciAqL1xuXHRAT25lVG9NYW55KCgpID0+IFBlcm1pc3Npb24sIChwZXJtaXNzaW9uKSA9PiBwZXJtaXNzaW9uLnVzZXIsIHsgY2FzY2FkZTogW0Nhc2NhZGUuUkVNT1ZFXSwgb3JwaGFuUmVtb3ZhbDogdHJ1ZSB9KVxuXHRwZXJtaXNzaW9ucyA9IG5ldyBDb2xsZWN0aW9uPFBlcm1pc3Npb24+KHRoaXMpO1xuXG5cdC8qKiBMaW5rZWQgcm9sZXMgdG8gdGhlIHVzZXIgKi9cblx0QE1hbnlUb01hbnkoKCkgPT4gUm9sZSwgKHJvbGUpID0+IHJvbGUudXNlcnMpXG5cdHJvbGVzID0gbmV3IENvbGxlY3Rpb248Um9sZT4odGhpcyk7XG5cblx0QE9uZVRvTWFueSgoKSA9PiBMb2csIChsb2cpID0+IGxvZy51c2VyLCB7IGNhc2NhZGU6IFtDYXNjYWRlLlJFTU9WRV0sIG9ycGhhblJlbW92YWw6IHRydWUgfSlcblx0bG9ncyA9IG5ldyBDb2xsZWN0aW9uPExvZz4odGhpcyk7XG59XG4iXSwidmVyc2lvbiI6M30=