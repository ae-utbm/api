0114a3e71e4e54af30c4015e5e392ffe
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const supertest_1 = __importDefault(require("supertest"));
const user_entity_1 = require("@modules/users/entities/user.entity");
const responses_1 = require("@utils/responses");
const base_setup_1 = require("../base.setup");
describe('LogsController (e2e)', () => {
    let tokenUnverified;
    let userIdUnverified;
    let tokenUnauthorized;
    let userIdUnauthorized;
    let tokenLogModerator;
    let userIdLogModerator;
    beforeAll(async () => {
        const responseA = await (0, supertest_1.default)(base_setup_1.app.getHttpServer()).post('/api/auth/login').send({
            email: 'unverified@email.com',
            password: 'root',
        });
        tokenUnverified = responseA.body.token;
        userIdUnverified = responseA.body.user_id;
        const responseB = await (0, supertest_1.default)(base_setup_1.app.getHttpServer()).post('/api/auth/login').send({
            email: 'unauthorized@email.com',
            password: 'root',
        });
        tokenUnauthorized = responseB.body.token;
        userIdUnauthorized = responseB.body.user_id;
        const responseC = await (0, supertest_1.default)(base_setup_1.app.getHttpServer()).post('/api/auth/login').send({
            email: 'logs@email.com',
            password: 'root',
        });
        tokenLogModerator = responseC.body.token;
        userIdLogModerator = responseC.body.user_id;
    });
    describe('/api/logs/user/{user_id} (GET)', () => {
        it('should return 401 when the user is not authenticated', async () => {
            const response = await (0, supertest_1.default)(base_setup_1.app.getHttpServer()).get('/api/logs/user/1').expect(401);
            expect(response.body).toEqual({
                // TODO: add an error message ('Unauthorized') and translate the message field (add more context too)
                statusCode: 401,
                message: 'Unauthorized',
            });
        });
        it('should return 403 when the user is not the same as the user ID in the request', async () => {
            const response = await (0, supertest_1.default)(base_setup_1.app.getHttpServer())
                .get(`/api/logs/user/${userIdUnverified}`)
                .set('Authorization', `Bearer ${tokenUnauthorized}`)
                .expect(403);
            expect(response.body).toEqual({
                error: 'Forbidden',
                statusCode: 403,
                message: 'Forbidden resource', // TODO translate this
            });
        });
        it('should return 404 when the user does not exist', async () => {
            const fakeId = 9999;
            const response = await (0, supertest_1.default)(base_setup_1.app.getHttpServer())
                .get(`/api/logs/user/${fakeId}`)
                .set('Authorization', `Bearer ${tokenLogModerator}`)
                .expect(404);
            expect(response.body).toEqual({
                error: 'Not Found',
                statusCode: 404,
                message: (0, responses_1.idNotFound)({ i18n: base_setup_1.i18n, type: user_entity_1.User, id: fakeId }),
            });
        });
        it('should return 400 when the user ID is invalid', async () => {
            const fakeId = 'invalid';
            const response = await (0, supertest_1.default)(base_setup_1.app.getHttpServer())
                .get(`/api/logs/user/${fakeId}`)
                .set('Authorization', `Bearer ${tokenLogModerator}`)
                .expect(400);
            expect(response.body).toEqual({
                error: 'Bad Request',
                statusCode: 400,
                message: (0, responses_1.idInvalid)({ i18n: base_setup_1.i18n, type: user_entity_1.User, id: fakeId }),
            });
        });
        it('should return 401 when user is not verified', async () => {
            const response = await (0, supertest_1.default)(base_setup_1.app.getHttpServer())
                .get(`/api/logs/user/${userIdUnverified}`)
                .set('Authorization', `Bearer ${tokenUnverified}`)
                .expect(401);
            expect(response.body).toEqual({
                statusCode: 401,
                message: (0, responses_1.emailNotVerified)({ i18n: base_setup_1.i18n, type: user_entity_1.User }),
                error: 'Unauthorized',
            });
        });
        it('should return 200 when user is asking for another user with the right permission', async () => {
            const response = await (0, supertest_1.default)(base_setup_1.app.getHttpServer())
                .get(`/api/logs/user/${userIdUnauthorized}`)
                .set('Authorization', `Bearer ${tokenLogModerator}`)
                .expect(200);
            expect(response.body).toEqual(expect.any(Array));
        });
        it('should return 403 when user is asking for another user without the permission', async () => {
            const response = await (0, supertest_1.default)(base_setup_1.app.getHttpServer())
                .get(`/api/logs/user/${userIdLogModerator}`)
                .set('Authorization', `Bearer ${tokenUnauthorized}`)
                .expect(403);
            expect(response.body).toEqual({
                error: 'Forbidden',
                statusCode: 403,
                message: 'Forbidden resource', // TODO translate this
            });
        });
    });
    describe('/api/logs/{user} (DELETE)', () => {
        // it();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2p1a251bS9Eb2N1bWVudHMvQ29kZS9BRS9hcGkvdGVzdC9lMmUvbG9ncy50ZXN0LnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsMERBQWdDO0FBR2hDLHFFQUEyRDtBQUMzRCxnREFBMkU7QUFFM0UsOENBQTBDO0FBRTFDLFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUU7SUFDckMsSUFBSSxlQUF1QixDQUFDO0lBQzVCLElBQUksZ0JBQXdCLENBQUM7SUFFN0IsSUFBSSxpQkFBeUIsQ0FBQztJQUM5QixJQUFJLGtCQUEwQixDQUFDO0lBRS9CLElBQUksaUJBQXlCLENBQUM7SUFDOUIsSUFBSSxrQkFBMEIsQ0FBQztJQUUvQixTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFHcEIsTUFBTSxTQUFTLEdBQVEsTUFBTSxJQUFBLG1CQUFPLEVBQUMsZ0JBQUcsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLElBQUksQ0FBQztZQUN0RixLQUFLLEVBQUUsc0JBQXNCO1lBQzdCLFFBQVEsRUFBRSxNQUFNO1NBQ2hCLENBQUMsQ0FBQztRQUVILGVBQWUsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN2QyxnQkFBZ0IsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUUxQyxNQUFNLFNBQVMsR0FBUSxNQUFNLElBQUEsbUJBQU8sRUFBQyxnQkFBRyxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUMsSUFBSSxDQUFDO1lBQ3RGLEtBQUssRUFBRSx3QkFBd0I7WUFDL0IsUUFBUSxFQUFFLE1BQU07U0FDaEIsQ0FBQyxDQUFDO1FBRUgsaUJBQWlCLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDekMsa0JBQWtCLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7UUFFNUMsTUFBTSxTQUFTLEdBQVEsTUFBTSxJQUFB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QUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUNsRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywrRUFBK0UsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM5RixNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxnQkFBRyxDQUFDLGFBQWEsRUFBRSxDQUFDO2lCQUNqRCxHQUFHLENBQUMsa0JBQWtCLGtCQUFrQixFQUFFLENBQUM7aUJBQzNDLEdBQUcsQ0FBQyxlQUFlLEVBQUUsVUFBVSxpQkFBaUIsRUFBRSxDQUFDO2lCQUNuRCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFZCxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQztnQkFDN0IsS0FBSyxFQUFFLFdBQVc7Z0JBQ2xCLFVBQVUsRUFBRSxHQUFHO2dCQUNmLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxzQkFBc0I7YUFDckQsQ0FBQyxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7UUFDMUMsUUFBUTtJQUNULENBQUMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2p1a251bS9Eb2N1bWVudHMvQ29kZS9BRS9hcGkvdGVzdC9lMmUvbG9ncy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCByZXF1ZXN0IGZyb20gJ3N1cGVydGVzdCc7XG5cbmltcG9ydCB7IFRva2VuRFRPIH0gZnJvbSAnQG1vZHVsZXMvYXV0aC9kdG8vdG9rZW4uZHRvJztcbmltcG9ydCB7IFVzZXIgfSBmcm9tICdAbW9kdWxlcy91c2Vycy9lbnRpdGllcy91c2VyLmVudGl0eSc7XG5pbXBvcnQgeyBlbWFpbE5vdFZlcmlmaWVkLCBpZEludmFsaWQsIGlkTm90Rm91bmQgfSBmcm9tICdAdXRpbHMvcmVzcG9uc2VzJztcblxuaW1wb3J0IHsgYXBwLCBpMThuIH0gZnJvbSAnLi4vYmFzZS5zZXR1cCc7XG5cbmRlc2NyaWJlKCdMb2dzQ29udHJvbGxlciAoZTJlKScsICgpID0+IHtcblx0bGV0IHRva2VuVW52ZXJpZmllZDogc3RyaW5nO1xuXHRsZXQgdXNlcklkVW52ZXJpZmllZDogbnVtYmVyO1xuXG5cdGxldCB0b2tlblVuYXV0aG9yaXplZDogc3RyaW5nO1xuXHRsZXQgdXNlcklkVW5hdXRob3JpemVkOiBudW1iZXI7XG5cblx0bGV0IHRva2VuTG9nTW9kZXJhdG9yOiBzdHJpbmc7XG5cdGxldCB1c2VySWRMb2dNb2RlcmF0b3I6IG51bWJlcjtcblxuXHRiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuXHRcdHR5cGUgUmVzID0gT21pdDxyZXF1ZXN0LlJlc3BvbnNlLCAnYm9keSc+ICYgeyBib2R5OiBUb2tlbkRUTyB9O1xuXG5cdFx0Y29uc3QgcmVzcG9uc2VBOiBSZXMgPSBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpLnBvc3QoJy9hcGkvYXV0aC9sb2dpbicpLnNlbmQoe1xuXHRcdFx0ZW1haWw6ICd1bnZlcmlmaWVkQGVtYWlsLmNvbScsXG5cdFx0XHRwYXNzd29yZDogJ3Jvb3QnLFxuXHRcdH0pO1xuXG5cdFx0dG9rZW5VbnZlcmlmaWVkID0gcmVzcG9uc2VBLmJvZHkudG9rZW47XG5cdFx0dXNlcklkVW52ZXJpZmllZCA9IHJlc3BvbnNlQS5ib2R5LnVzZXJfaWQ7XG5cblx0XHRjb25zdCByZXNwb25zZUI6IFJlcyA9IGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSkucG9zdCgnL2FwaS9hdXRoL2xvZ2luJykuc2VuZCh7XG5cdFx0XHRlbWFpbDogJ3VuYXV0aG9yaXplZEBlbWFpbC5jb20nLFxuXHRcdFx0cGFzc3dvcmQ6ICdyb290Jyxcblx0XHR9KTtcblxuXHRcdHRva2VuVW5hdXRob3JpemVkID0gcmVzcG9uc2VCLmJvZHkudG9rZW47XG5cdFx0dXNlcklkVW5hdXRob3JpemVkID0gcmVzcG9uc2VCLmJvZHkudXNlcl9pZDtcblxuXHRcdGNvbnN0IHJlc3BvbnNlQzogUmVzID0gYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKS5wb3N0KCcvYXBpL2F1dGgvbG9naW4nKS5zZW5kKHtcblx0XHRcdGVtYWlsOiAnbG9nc0BlbWFpbC5jb20nLFxuXHRcdFx0cGFzc3dvcmQ6ICdyb290Jyxcblx0XHR9KTtcblxuXHRcdHRva2VuTG9nTW9kZXJhdG9yID0gcmVzcG9uc2VDLmJvZHkudG9rZW47XG5cdFx0dXNlcklkTG9nTW9kZXJhdG9yID0gcmVzcG9uc2VDLmJvZHkudXNlcl9pZDtcblx0fSk7XG5cblx0ZGVzY3JpYmUoJy9hcGkvbG9ncy91c2VyL3t1c2VyX2lkfSAoR0VUKScsICgpID0+IHtcblx0XHRpdCgnc2hvdWxkIHJldHVybiA0MDEgd2hlbiB0aGUgdXNlciBpcyBub3QgYXV0aGVudGljYXRlZCcsIGFzeW5jICgpID0+IHtcblx0XHRcdGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKS5nZXQoJy9hcGkvbG9ncy91c2VyLzEnKS5leHBlY3QoNDAxKTtcblxuXHRcdFx0ZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvRXF1YWwoe1xuXHRcdFx0XHQvLyBUT0RPOiBhZGQgYW4gZXJyb3IgbWVzc2FnZSAoJ1VuYXV0aG9yaXplZCcpIGFuZCB0cmFuc2xhdGUgdGhlIG1lc3NhZ2UgZmllbGQgKGFkZCBtb3JlIGNvbnRleHQgdG9vKVxuXHRcdFx0XHRzdGF0dXNDb2RlOiA0MDEsXG5cdFx0XHRcdG1lc3NhZ2U6ICdVbmF1dGhvcml6ZWQnLFxuXHRcdFx0fSk7XG5cdFx0fSk7XG5cblx0XHRpdCgnc2hvdWxkIHJldHVybiA0MDMgd2hlbiB0aGUgdXNlciBpcyBub3QgdGhlIHNhbWUgYXMgdGhlIHVzZXIgSUQgaW4gdGhlIHJlcXVlc3QnLCBhc3luYyAoKSA9PiB7XG5cdFx0XHRjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcblx0XHRcdFx0LmdldChgL2FwaS9sb2dzL3VzZXIvJHt1c2VySWRVbnZlcmlmaWVkfWApXG5cdFx0XHRcdC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7dG9rZW5VbmF1dGhvcml6ZWR9YClcblx0XHRcdFx0LmV4cGVjdCg0MDMpO1xuXG5cdFx0XHRleHBlY3QocmVzcG9uc2UuYm9keSkudG9FcXVhbCh7XG5cdFx0XHRcdGVycm9yOiAnRm9yYmlkZGVuJyxcblx0XHRcdFx0c3RhdHVzQ29kZTogNDAzLFxuXHRcdFx0XHRtZXNzYWdlOiAnRm9yYmlkZGVuIHJlc291cmNlJywgLy8gVE9ETyB0cmFuc2xhdGUgdGhpc1xuXHRcdFx0fSk7XG5cdFx0fSk7XG5cblx0XHRpdCgnc2hvdWxkIHJldHVybiA0MDQgd2hlbiB0aGUgdXNlciBkb2VzIG5vdCBleGlzdCcsIGFzeW5jICgpID0+IHtcblx0XHRcdGNvbnN0IGZha2VJZCA9IDk5OTk7XG5cblx0XHRcdGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuXHRcdFx0XHQuZ2V0KGAvYXBpL2xvZ3MvdXNlci8ke2Zha2VJZH1gKVxuXHRcdFx0XHQuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3Rva2VuTG9nTW9kZXJhdG9yfWApXG5cdFx0XHRcdC5leHBlY3QoNDA0KTtcblxuXHRcdFx0ZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvRXF1YWwoe1xuXHRcdFx0XHRlcnJvcjogJ05vdCBGb3VuZCcsXG5cdFx0XHRcdHN0YXR1c0NvZGU6IDQwNCxcblx0XHRcdFx0bWVzc2FnZTogaWROb3RGb3VuZCh7IGkxOG4sIHR5cGU6IFVzZXIsIGlkOiBmYWtlSWQgfSksXG5cdFx0XHR9KTtcblx0XHR9KTtcblxuXHRcdGl0KCdzaG91bGQgcmV0dXJuIDQwMCB3aGVuIHRoZSB1c2VyIElEIGlzIGludmFsaWQnLCBhc3luYyAoKSA9PiB7XG5cdFx0XHRjb25zdCBmYWtlSWQgPSAnaW52YWxpZCc7XG5cblx0XHRcdGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuXHRcdFx0XHQuZ2V0KGAvYXBpL2xvZ3MvdXNlci8ke2Zha2VJZH1gKVxuXHRcdFx0XHQuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3Rva2VuTG9nTW9kZXJhdG9yfWApXG5cdFx0XHRcdC5leHBlY3QoNDAwKTtcblxuXHRcdFx0ZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvRXF1YWwoe1xuXHRcdFx0XHRlcnJvcjogJ0JhZCBSZXF1ZXN0Jyxcblx0XHRcdFx0c3RhdHVzQ29kZTogNDAwLFxuXHRcdFx0XHRtZXNzYWdlOiBpZEludmFsaWQoeyBpMThuLCB0eXBlOiBVc2VyLCBpZDogZmFrZUlkIH0pLFxuXHRcdFx0fSk7XG5cdFx0fSk7XG5cblx0XHRpdCgnc2hvdWxkIHJldHVybiA0MDEgd2hlbiB1c2VyIGlzIG5vdCB2ZXJpZmllZCcsIGFzeW5jICgpID0+IHtcblx0XHRcdGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuXHRcdFx0XHQuZ2V0KGAvYXBpL2xvZ3MvdXNlci8ke3VzZXJJZFVudmVyaWZpZWR9YClcblx0XHRcdFx0LnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHt0b2tlblVudmVyaWZpZWR9YClcblx0XHRcdFx0LmV4cGVjdCg0MDEpO1xuXG5cdFx0XHRleHBlY3QocmVzcG9uc2UuYm9keSkudG9FcXVhbCh7XG5cdFx0XHRcdHN0YXR1c0NvZGU6IDQwMSxcblx0XHRcdFx0bWVzc2FnZTogZW1haWxOb3RWZXJpZmllZCh7IGkxOG4sIHR5cGU6IFVzZXIgfSksXG5cdFx0XHRcdGVycm9yOiAnVW5hdXRob3JpemVkJyxcblx0XHRcdH0pO1xuXHRcdH0pO1xuXG5cdFx0aXQoJ3Nob3VsZCByZXR1cm4gMjAwIHdoZW4gdXNlciBpcyBhc2tpbmcgZm9yIGFub3RoZXIgdXNlciB3aXRoIHRoZSByaWdodCBwZXJtaXNzaW9uJywgYXN5bmMgKCkgPT4ge1xuXHRcdFx0Y29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG5cdFx0XHRcdC5nZXQoYC9hcGkvbG9ncy91c2VyLyR7dXNlcklkVW5hdXRob3JpemVkfWApXG5cdFx0XHRcdC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7dG9rZW5Mb2dNb2RlcmF0b3J9YClcblx0XHRcdFx0LmV4cGVjdCgyMDApO1xuXG5cdFx0XHRleHBlY3QocmVzcG9uc2UuYm9keSkudG9FcXVhbChleHBlY3QuYW55KEFycmF5KSk7XG5cdFx0fSk7XG5cblx0XHRpdCgnc2hvdWxkIHJldHVybiA0MDMgd2hlbiB1c2VyIGlzIGFza2luZyBmb3IgYW5vdGhlciB1c2VyIHdpdGhvdXQgdGhlIHBlcm1pc3Npb24nLCBhc3luYyAoKSA9PiB7XG5cdFx0XHRjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcblx0XHRcdFx0LmdldChgL2FwaS9sb2dzL3VzZXIvJHt1c2VySWRMb2dNb2RlcmF0b3J9YClcblx0XHRcdFx0LnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHt0b2tlblVuYXV0aG9yaXplZH1gKVxuXHRcdFx0XHQuZXhwZWN0KDQwMyk7XG5cblx0XHRcdGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0VxdWFsKHtcblx0XHRcdFx0ZXJyb3I6ICdGb3JiaWRkZW4nLFxuXHRcdFx0XHRzdGF0dXNDb2RlOiA0MDMsXG5cdFx0XHRcdG1lc3NhZ2U6ICdGb3JiaWRkZW4gcmVzb3VyY2UnLCAvLyBUT0RPIHRyYW5zbGF0ZSB0aGlzXG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fSk7XG5cblx0ZGVzY3JpYmUoJy9hcGkvbG9ncy97dXNlcn0gKERFTEVURSknLCAoKSA9PiB7XG5cdFx0Ly8gaXQoKTtcblx0fSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==