174f3442457c9102df6de11236c2eb48
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Role = void 0;
const core_1 = require("@mikro-orm/core");
const swagger_1 = require("@nestjs/swagger");
const base_entity_1 = require("@modules/_mixin/entities/base.entity");
const user_entity_1 = require("@modules/users/entities/user.entity");
const perms_1 = require("src/types/api/permissions/perms");
/**
 * Entity used to store roles, which are a collection of permissions
 */
let Role = exports.Role = class Role extends base_entity_1.BaseEntity {
    constructor() {
        super(...arguments);
        /** Determine wether the role is still active */
        this.revoked = false;
        /** Specify to which user the role is attached */
        this.users = new core_1.Collection(this);
    }
};
__decorate([
    (0, core_1.Property)({ unique: true }),
    (0, swagger_1.ApiProperty)({ type: String, example: 'AE_ADMIN' }),
    __metadata("design:type", Object)
], Role.prototype, "name", void 0);
__decorate([
    (0, core_1.Property)({ name: 'is_revoked', onCreate: () => false }),
    (0, swagger_1.ApiProperty)({ type: Boolean, default: false }),
    __metadata("design:type", Object)
], Role.prototype, "revoked", void 0);
__decorate([
    (0, core_1.Property)({ name: 'expires_at' }),
    (0, swagger_1.ApiProperty)(),
    __metadata("design:type", Date)
], Role.prototype, "expires", void 0);
__decorate([
    (0, core_1.Property)({ name: 'permissions' }),
    (0, swagger_1.ApiProperty)({ enum: perms_1.PERMISSIONS_NAMES, isArray: true }),
    __metadata("design:type", Array)
], Role.prototype, "permissions", void 0);
__decorate([
    (0, core_1.ManyToMany)(() => user_entity_1.User, (user) => user.roles, { owner: true }),
    __metadata("design:type", Object)
], Role.prototype, "users", void 0);
exports.Role = Role = __decorate([
    (0, core_1.Entity)({ tableName: 'roles' })
], Role);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2p1a251bS9Eb2N1bWVudHMvQ29kZS9BRS9hcGkvc3JjL21vZHVsZXMvcm9sZXMvZW50aXRpZXMvcm9sZS5lbnRpdHkudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBRUEsMENBQTJFO0FBQzNFLDZDQUE4QztBQUU5QyxzRUFBa0U7QUFFbEUscUVBQTJEO0FBQzNELDJEQUFvRTtBQUVwRTs7R0FFRztBQUVJLElBQU0sSUFBSSxrQkFBVixNQUFNLElBQUssU0FBUSx3QkFBVTtJQUE3Qjs7UUFNTixnREFBZ0Q7UUFHaEQsWUFBTyxHQUFHLEtBQUssQ0FBQztRQVloQixpREFBaUQ7UUFFakQsVUFBSyxHQUFHLElBQUksaUJBQVUsQ0FBTyxJQUFJLENBQUMsQ0FBQztJQUNwQyxDQUFDO0NBQUEsQ0FBQTtBQXBCQTtJQUZDLElBQUEsZUFBUSxFQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDO0lBQzFCLElBQUEscUJBQVcsRUFBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxDQUFDOztrQ0FDM0I7QUFLeEI7SUFGQyxJQUFBLGVBQVEsRUFBQyxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3ZELElBQUEscUJBQVcsRUFBQyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxDQUFDOztxQ0FDL0I7QUFLaEI7SUFGQyxJQUFBLGVBQVEsRUFBQyxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsQ0FBQztJQUNoQyxJQUFBLHFCQUFXLEdBQUU7OEJBQ0wsSUFBSTtxQ0FBQztBQUtkO0lBRkMsSUFBQSxlQUFRLEVBQUMsRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFFLENBQUM7SUFDakMsSUFBQSxxQkFBVyxFQUFDLEVBQUUsSUFBSSxFQUFFLHlCQUFpQixFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQzs7eUNBQzFCO0FBSTlCO0lBREMsSUFBQSxpQkFBVSxFQUFDLEdBQUcsRUFBRSxDQUFDLGtCQUFJLEVBQUUsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUM7O21DQUMzQjtlQXZCdkIsSUFBSTtJQURoQixJQUFBLGFBQU0sRUFBQyxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsQ0FBQztHQUNsQixJQUFJLENBd0JoQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvanVrbnVtL0RvY3VtZW50cy9Db2RlL0FFL2FwaS9zcmMvbW9kdWxlcy9yb2xlcy9lbnRpdGllcy9yb2xlLmVudGl0eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFBlcm1pc3Npb25OYW1lLCBSb2xlRW50aXR5IH0gZnJvbSAnQHR5cGVzJztcblxuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRW50aXR5LCBNYW55VG9NYW55LCBQcm9wZXJ0eSB9IGZyb20gJ0BtaWtyby1vcm0vY29yZSc7XG5pbXBvcnQgeyBBcGlQcm9wZXJ0eSB9IGZyb20gJ0BuZXN0anMvc3dhZ2dlcic7XG5cbmltcG9ydCB7IEJhc2VFbnRpdHkgfSBmcm9tICdAbW9kdWxlcy9fbWl4aW4vZW50aXRpZXMvYmFzZS5lbnRpdHknO1xuaW1wb3J0IHsgUGVybWlzc2lvbiB9IGZyb20gJ0Btb2R1bGVzL3Blcm1pc3Npb25zL2VudGl0aWVzL3Blcm1pc3Npb24uZW50aXR5JztcbmltcG9ydCB7IFVzZXIgfSBmcm9tICdAbW9kdWxlcy91c2Vycy9lbnRpdGllcy91c2VyLmVudGl0eSc7XG5pbXBvcnQgeyBQRVJNSVNTSU9OU19OQU1FUyB9IGZyb20gJ3NyYy90eXBlcy9hcGkvcGVybWlzc2lvbnMvcGVybXMnO1xuXG4vKipcbiAqIEVudGl0eSB1c2VkIHRvIHN0b3JlIHJvbGVzLCB3aGljaCBhcmUgYSBjb2xsZWN0aW9uIG9mIHBlcm1pc3Npb25zXG4gKi9cbkBFbnRpdHkoeyB0YWJsZU5hbWU6ICdyb2xlcycgfSlcbmV4cG9ydCBjbGFzcyBSb2xlIGV4dGVuZHMgQmFzZUVudGl0eSBpbXBsZW1lbnRzIFJvbGVFbnRpdHk8UGVybWlzc2lvbiwgVXNlcj4ge1xuXHQvKiogTmFtZSBvZiB0aGUgcm9sZSwgaW4gY2FwcyAqL1xuXHRAUHJvcGVydHkoeyB1bmlxdWU6IHRydWUgfSlcblx0QEFwaVByb3BlcnR5KHsgdHlwZTogU3RyaW5nLCBleGFtcGxlOiAnQUVfQURNSU4nIH0pXG5cdG5hbWU6IFVwcGVyY2FzZTxzdHJpbmc+O1xuXG5cdC8qKiBEZXRlcm1pbmUgd2V0aGVyIHRoZSByb2xlIGlzIHN0aWxsIGFjdGl2ZSAqL1xuXHRAUHJvcGVydHkoeyBuYW1lOiAnaXNfcmV2b2tlZCcsIG9uQ3JlYXRlOiAoKSA9PiBmYWxzZSB9KVxuXHRAQXBpUHJvcGVydHkoeyB0eXBlOiBCb29sZWFuLCBkZWZhdWx0OiBmYWxzZSB9KVxuXHRyZXZva2VkID0gZmFsc2U7XG5cblx0LyoqIFNwZWNpZnkgd2hlbiB0aGUgcm9sZSBzaG91bGQgZXhwaXJlcyAqL1xuXHRAUHJvcGVydHkoeyBuYW1lOiAnZXhwaXJlc19hdCcgfSlcblx0QEFwaVByb3BlcnR5KClcblx0ZXhwaXJlczogRGF0ZTtcblxuXHQvKiogU3BlY2lmeSB3aGF0IHBlcm1pc3Npb25zIHRoZSByb2xlIGhhcyAqL1xuXHRAUHJvcGVydHkoeyBuYW1lOiAncGVybWlzc2lvbnMnIH0pXG5cdEBBcGlQcm9wZXJ0eSh7IGVudW06IFBFUk1JU1NJT05TX05BTUVTLCBpc0FycmF5OiB0cnVlIH0pXG5cdHBlcm1pc3Npb25zOiBQZXJtaXNzaW9uTmFtZVtdO1xuXG5cdC8qKiBTcGVjaWZ5IHRvIHdoaWNoIHVzZXIgdGhlIHJvbGUgaXMgYXR0YWNoZWQgKi9cblx0QE1hbnlUb01hbnkoKCkgPT4gVXNlciwgKHVzZXIpID0+IHVzZXIucm9sZXMsIHsgb3duZXI6IHRydWUgfSlcblx0dXNlcnMgPSBuZXcgQ29sbGVjdGlvbjxVc2VyPih0aGlzKTtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==