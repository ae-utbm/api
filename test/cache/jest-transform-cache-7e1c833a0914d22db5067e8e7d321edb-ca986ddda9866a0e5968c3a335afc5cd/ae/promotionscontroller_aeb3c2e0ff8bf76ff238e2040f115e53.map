{"version":3,"names":["cov_2qo724bcvw","actualCoverage","common_1","s","require","passport_1","platform_express_1","swagger_1","permissions_decorator_1","permission_guard_1","images_1","promotion_dto_1","promotions_service_1","base_user_dto_1","PromotionsController","exports","constructor","promotionsService","f","getAll","findAll","get","number","findOne","getUsers","getLatest","findLatest","editLogo","file","updateLogo","getLogo","logo","StreamableFile","getStreamableFile","path","deleteLogo","__decorate","Get","UseGuards","PermissionGuard","GuardPermissions","ApiOkResponse","type","PromotionResponseDTO","ApiOperation","summary","ApiParam","name","description","__param","Param","BaseUserResponseDTO","Post","ApiConsumes","ApiBody","schema","properties","format","UseInterceptors","FileInterceptor","UploadedFile","Delete","ApiTags","Controller","AuthGuard","ApiBearerAuth","PromotionsService"],"sources":["/Users/juknum/Documents/Code/AE/api/src/modules/promotions/promotions.controller.ts"],"sourcesContent":["import {\n\tController,\n\tDelete,\n\tGet,\n\tParam,\n\tPost,\n\tStreamableFile,\n\tUploadedFile,\n\tUseGuards,\n\tUseInterceptors,\n} from '@nestjs/common';\nimport { AuthGuard } from '@nestjs/passport';\nimport { FileInterceptor } from '@nestjs/platform-express';\nimport { ApiBearerAuth, ApiBody, ApiConsumes, ApiOkResponse, ApiOperation, ApiParam, ApiTags } from '@nestjs/swagger';\n\nimport { GuardPermissions } from '@modules/auth/decorators/permissions.decorator';\nimport { PermissionGuard } from '@modules/auth/guards/permission.guard';\nimport { getStreamableFile } from '@utils/images';\n\nimport { PromotionResponseDTO } from './dto/promotion.dto';\nimport { PromotionsService } from './promotions.service';\nimport { BaseUserResponseDTO } from '../users/dto/base-user.dto';\n\n@ApiTags('Promotions')\n@Controller('promotions')\n@UseGuards(AuthGuard('jwt'))\n@ApiBearerAuth()\nexport class PromotionsController {\n\tconstructor(private readonly promotionsService: PromotionsService) {}\n\n\t@Get()\n\t@UseGuards(PermissionGuard)\n\t@GuardPermissions('CAN_READ_PROMOTION')\n\t@ApiOkResponse({ type: [PromotionResponseDTO] })\n\t@ApiOperation({ summary: 'Get all promotions' })\n\tasync getAll() {\n\t\treturn this.promotionsService.findAll();\n\t}\n\n\t@Get(':number')\n\t@UseGuards(PermissionGuard)\n\t@GuardPermissions('CAN_READ_PROMOTION')\n\t@ApiOkResponse({ type: PromotionResponseDTO })\n\t@ApiParam({ name: 'number', description: 'The promotion number (eg: 21)' })\n\t@ApiOperation({ summary: 'Get the specified promotion' })\n\tasync get(@Param('number') number: number) {\n\t\treturn this.promotionsService.findOne(number);\n\t}\n\n\t@Get(':number/users')\n\t@UseGuards(PermissionGuard)\n\t@GuardPermissions('CAN_READ_PROMOTION')\n\t@ApiOkResponse({ type: [BaseUserResponseDTO] })\n\t@ApiParam({ name: 'number', description: 'The promotion number (eg: 21)' })\n\t@ApiOperation({ summary: 'Get users of the specified promotions' })\n\tasync getUsers(@Param('number') number: number) {\n\t\treturn this.promotionsService.getUsers(number);\n\t}\n\n\t@Get('latest')\n\t@UseGuards(PermissionGuard)\n\t@GuardPermissions('CAN_READ_PROMOTION')\n\t@ApiOkResponse({ type: PromotionResponseDTO })\n\t@ApiOperation({ summary: 'Get the latest promotion created' })\n\tasync getLatest() {\n\t\treturn this.promotionsService.findLatest();\n\t}\n\n\t@Post('logo/:number')\n\t@UseGuards(PermissionGuard)\n\t@GuardPermissions('CAN_EDIT_PROMOTION')\n\t@ApiConsumes('multipart/form-data')\n\t@ApiParam({ name: 'number', description: 'The promotion number (eg: 21)' })\n\t@ApiOperation({ summary: 'Update the promotion logo' })\n\t@ApiBody({\n\t\tschema: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tfile: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tformat: 'binary',\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t})\n\t@UseInterceptors(FileInterceptor('file'))\n\tasync editLogo(@UploadedFile() file: Express.Multer.File, @Param('number') number: number) {\n\t\treturn this.promotionsService.updateLogo({ number, file });\n\t}\n\n\t@Get('logo/:number')\n\t@UseGuards(PermissionGuard)\n\t@GuardPermissions('CAN_READ_PROMOTION')\n\t@ApiParam({ name: 'number', description: 'The promotion number (eg: 21)' })\n\t@ApiOperation({ summary: 'Get the promotion logo' })\n\tasync getLogo(@Param('number') number: number) {\n\t\tconst logo = await this.promotionsService.getLogo(number);\n\t\treturn new StreamableFile(getStreamableFile(logo.path));\n\t}\n\n\t@Delete('logo/:number')\n\t@UseGuards(PermissionGuard)\n\t@GuardPermissions('CAN_EDIT_PROMOTION')\n\t@ApiParam({ name: 'number', description: 'The promotion number (eg: 21)' })\n\t@ApiOperation({ summary: 'Delete the promotion logo' })\n\tasync deleteLogo(@Param('number') number: number) {\n\t\treturn this.promotionsService.deleteLogo(number);\n\t}\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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"}