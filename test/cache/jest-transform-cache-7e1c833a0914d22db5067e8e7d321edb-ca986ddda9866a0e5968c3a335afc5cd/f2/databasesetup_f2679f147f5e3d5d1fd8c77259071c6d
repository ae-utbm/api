60c2d8797862b9c18a77917c2b529786
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
require("tsconfig-paths/register");
const path_1 = __importDefault(require("path"));
const core_1 = require("@mikro-orm/core");
const database_seeder_1 = require("@database/seeders/database.seeder");
const _mikro_orm_config_1 = __importDefault(require("@mikro-orm.config"));
/**
 * This function is used to setup the database before running the tests.
 */
async function setup() {
    const orm = await core_1.MikroORM.init({
        ..._mikro_orm_config_1.default,
        debug: false,
        // Entities paths are relative to the root of the project so we need to update them
        entities: [path_1.default.join(__dirname, '../../dist/src/modules/**/*.entity.js')],
        entitiesTs: [path_1.default.join(__dirname, '../src/modules/**/*.entity.ts')],
    });
    // Drop and re-create the database schema
    const generator = orm.getSchemaGenerator();
    await generator.dropSchema();
    await generator.createSchema();
    // Seed the database with some basic data
    const seeder = orm.getSeeder();
    await seeder.seed(database_seeder_1.DatabaseSeeder);
    await orm.close(true);
}
exports.default = setup;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2p1a251bS9Eb2N1bWVudHMvQ29kZS9BRS9hcGkvdGVzdC9kYXRhYmFzZS5zZXR1cC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLG1DQUFpQztBQUVqQyxnREFBd0I7QUFFeEIsMENBQTJDO0FBRTNDLHVFQUFtRTtBQUNuRSwwRUFBdUM7QUFFdkM7O0dBRUc7QUFDSCxLQUFLLFVBQVUsS0FBSztJQUNuQixNQUFNLEdBQUcsR0FBRyxNQUFNLGVBQVEsQ0FBQyxJQUFJLENBQUM7UUFDL0IsR0FBRywyQkFBTTtRQUNULEtBQUssRUFBRSxLQUFLO1FBQ1osbUZBQW1GO1FBQ25GLFFBQVEsRUFBRSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLHVDQUF1QyxDQUFDLENBQUM7UUFDekUsVUFBVSxFQUFFLENBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsK0JBQStCLENBQUMsQ0FBQztLQUNuRSxDQUFDLENBQUM7SUFFSCx5Q0FBeUM7SUFDekMsTUFBTSxTQUFTLEdBQUcsR0FBRyxDQUFDLGtCQUFrQixFQUFFLENBQUM7SUFDM0MsTUFBTSxTQUFTLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDN0IsTUFBTSxTQUFTLENBQUMsWUFBWSxFQUFFLENBQUM7SUFFL0IseUNBQXlDO0lBQ3pDLE1BQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUMvQixNQUFNLE1BQU0sQ0FBQyxJQUFJLENBQUMsZ0NBQWMsQ0FBQyxDQUFDO0lBRWxDLE1BQU0sR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUN2QixDQUFDO0FBRUQsa0JBQWUsS0FBSyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9qdWtudW0vRG9jdW1lbnRzL0NvZGUvQUUvYXBpL3Rlc3QvZGF0YWJhc2Uuc2V0dXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICd0c2NvbmZpZy1wYXRocy9yZWdpc3Rlcic7XG5cbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuXG5pbXBvcnQgeyBNaWtyb09STSB9IGZyb20gJ0BtaWtyby1vcm0vY29yZSc7XG5cbmltcG9ydCB7IERhdGFiYXNlU2VlZGVyIH0gZnJvbSAnQGRhdGFiYXNlL3NlZWRlcnMvZGF0YWJhc2Uuc2VlZGVyJztcbmltcG9ydCBjb25maWcgZnJvbSAnQG1pa3JvLW9ybS5jb25maWcnO1xuXG4vKipcbiAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBzZXR1cCB0aGUgZGF0YWJhc2UgYmVmb3JlIHJ1bm5pbmcgdGhlIHRlc3RzLlxuICovXG5hc3luYyBmdW5jdGlvbiBzZXR1cCgpIHtcblx0Y29uc3Qgb3JtID0gYXdhaXQgTWlrcm9PUk0uaW5pdCh7XG5cdFx0Li4uY29uZmlnLFxuXHRcdGRlYnVnOiBmYWxzZSwgLy8gSGlkZSBkZWJ1ZyBsb2dzIGZvciB0aGUgZGF0YWJhc2Ugc2V0dXBcblx0XHQvLyBFbnRpdGllcyBwYXRocyBhcmUgcmVsYXRpdmUgdG8gdGhlIHJvb3Qgb2YgdGhlIHByb2plY3Qgc28gd2UgbmVlZCB0byB1cGRhdGUgdGhlbVxuXHRcdGVudGl0aWVzOiBbcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uLy4uL2Rpc3Qvc3JjL21vZHVsZXMvKiovKi5lbnRpdHkuanMnKV0sXG5cdFx0ZW50aXRpZXNUczogW3BhdGguam9pbihfX2Rpcm5hbWUsICcuLi9zcmMvbW9kdWxlcy8qKi8qLmVudGl0eS50cycpXSxcblx0fSk7XG5cblx0Ly8gRHJvcCBhbmQgcmUtY3JlYXRlIHRoZSBkYXRhYmFzZSBzY2hlbWFcblx0Y29uc3QgZ2VuZXJhdG9yID0gb3JtLmdldFNjaGVtYUdlbmVyYXRvcigpO1xuXHRhd2FpdCBnZW5lcmF0b3IuZHJvcFNjaGVtYSgpO1xuXHRhd2FpdCBnZW5lcmF0b3IuY3JlYXRlU2NoZW1hKCk7XG5cblx0Ly8gU2VlZCB0aGUgZGF0YWJhc2Ugd2l0aCBzb21lIGJhc2ljIGRhdGFcblx0Y29uc3Qgc2VlZGVyID0gb3JtLmdldFNlZWRlcigpO1xuXHRhd2FpdCBzZWVkZXIuc2VlZChEYXRhYmFzZVNlZWRlcik7XG5cblx0YXdhaXQgb3JtLmNsb3NlKHRydWUpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBzZXR1cDtcbiJdLCJ2ZXJzaW9uIjozfQ==