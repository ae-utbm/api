{"version":3,"names":["cov_24foqu0lic","actualCoverage","nodemailer_1","s","require","_env_1","__importDefault","checkEmail","email","f","blacklist","default","host","whitelisted","whitelist","includes","b","some","endsWith","regex","RegExp","test","exports","transporter","createTransport","port","secure","auth","user","pass","sendEmail","options","disabled","sendMail","from","to","join","subject","html"],"sources":["/Users/juknum/Documents/Code/AE/api/src/utils/email.ts"],"sourcesContent":["import type { Email } from '@types';\n\nimport { createTransport } from 'nodemailer';\n\nimport env from '@env';\n\n/**\n * Check if an email is allowed to be used (to register for example) and if it is valid\n * @param {Email} email the email to check\n * @returns {boolean} true if the email is allowed, false otherwise\n */\nexport function checkEmail(email: Email): boolean {\n\tconst blacklist = env().email.blacklist.host;\n\tconst whitelisted = env().email.whitelist.email;\n\n\tif (whitelisted.includes(email)) return true;\n\telse if (blacklist.some((host) => email.endsWith(host))) return false;\n\n\tconst regex = new RegExp(/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/);\n\treturn regex.test(email);\n}\n\nconst transporter = createTransport({\n\thost: env().email.host,\n\tport: env().email.port,\n\tsecure: env().email.secure,\n\tauth: {\n\t\tuser: env().email.auth.user,\n\t\tpass: env().email.auth.pass,\n\t},\n});\n\ninterface EmailOptions {\n\tto: string[];\n\tfrom?: string;\n\tsubject: string;\n\thtml: string;\n}\n\n/**\n * Send en email based on a template and given data\n * @param {EmailOptions} options the options for the email\n */\nexport async function sendEmail(options: EmailOptions): Promise<void> {\n\tif (env().email.disabled) return;\n\n\tawait transporter.sendMail({\n\t\tfrom: options.from ?? `ae.noreply@utbm.fr`,\n\t\tto: options.to.join(', '),\n\t\tsubject: options.subject,\n\t\thtml: options.html,\n\t});\n}\n"],"mappings":"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"}